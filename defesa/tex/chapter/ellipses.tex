In this chapter, we introduce the version of PMCLP where every 
facility has an axis-parallel ellipse as its coverage area. We refer to this problem as \sigla{MCE}{Maximum Covering by Ellipses}. We also present an algorithm for it which is an adaptation of the algorithm developed for MCD in \autoref{chapter:pmclp}.

\section{Definition}

Axis-parallel ellipses are defined as the set of points that satisfy \autoref{equation:pellipse}. Note that all it takes to describe an axis-parallel ellipse is a pair of positive real numbers $(a,b) \in \R_{>0}^2$, also called its shape parameters, and a center point $q \in \R^2$.

An instance of MCE is given by a set of $n$ demand points $\Pp = \{p_1, \dots, p_n\}$, with $p_j\in\R^2$; and a set of $m$ ellipses $\E = \{E_1, \dots, E_m\}$, which represents the facilities and are used to cover the demand set. Additionally, 
a list of weights $\Ww:=\{w_1, \dots, w_n\}$ and a list of shape parameters $\Rr:=\{(a_1, b_1), \dots, (a_m, b_m)\}$ are given. The weight of the $j$-th point is $w_j\in\R_{>0}$, and the shape parameters of the $j$-th ellipse is given by $(a_j, b_j)\in\R_{>0}^2$, with $a_j>b_j$.
To make the text more clear, we denote an instance of MCE as $\Pi:=(\Pp, \Ww, \Rr)$.

A solution for MCE is given by $Q:=(q_1, \dots, q_m)\in\R^{2m}$, with $q_j$ being the center of $j$-th ellipse. The coverage region of $j$-th ellipse centered at $q_j$ is denoted by $E_j(q_j)$. Finally, let $w : 2^\Pp \mapsto \R_{\ge0}$ as defined by \autoref{eq:subset_w}, then an optimal solution of MCE is given by the optimization problem

\begin{equation}
\max_q w\left(\bigcup_{j=1}^m \Pp \cap E_j(q_j)\right).
\end{equation}

Firstly, we describe a method for the case with only one ellipse, and then use it in the algorithm for multiple ellipses to construct a CLS containing an optimal solution.

\section{Related work}
The maximal planar covering using axis-parallel ellipses was first introduced in \citeonline{canbolat} which proposed a mixed integer non-linear programming method for the problem. This first approach showed to be not that efficient as it could not find an optimal solution for some instances within a timeout defined by them. To obtain solutions, not necessarily optimal ones, for the instances which the exact method showed inefficiency, a heuristic technique called Simulated Annealing was used to develop another method. Comparisons were made, which showed that the second approach was able to obtain good solutions, compared to the optimal ones found for some of the instances, within a good run-time.

The second work found in the literature was \citeonline{andreta}, which developed a method that breaks the problem into smaller ones fixing the set of points an ellipse is going to cover. For each set of points fixed as the points an ellipse is going to cover, a small optimization problem is solved to find out if there is a location where the ellipse can be placed, so to cover the set of fixed points. To enumerate the possible solutions and then find an optimal one, the method defined a data structure that stores every set of points an ellipse can cover. This method showed better results and was able to find optimal solutions for the instances that the first method could not get as well as for new created instances.


\section{One Ellipse Version}

Firstly, the case with only one ellipse is considered. An instance of it has $m=1$, and we set $(a, b):=(a_1, b_1)$ and $\E := \{E\}$. We refer to this version as \sigla{MCE-1}{Maximum Cover by One Ellipse} and a solution of it is given by a point $q\in\R^2$. Also, an optimal solution of MCE-1 is given by
\begin{equation}
\max_q w(\Pp \cap E(q)).
\end{equation}

An adaptation of \autoref{algoritmo:mcd_1} is obtained by just replacing the function that finds the intersection points between two disks by a function that finds the intersection points between two ellipses $E_i$ and $E_j$.
It can be seen in \autoref{fig:3ellipses_intersect} that the intersection points and their correspondents $\Gamma_-(i,j)$ and $\Gamma_+(i,j)$ functions behave the same way as in the disks case.

The intersection of two ellipses as well as determining $\Gamma_-(i,j)$ and $\Gamma_+(i,j)$ are described thoroughly in \autoref{chapter:ellipses_intersection}. 


\begin{figure}[H]
\centering

    \caption{Three ellipses and their intersection points}
    \input{tex/img.ellipses.1.tex}
    \fautor
    \label{fig:3ellipses_intersect}
\end{figure}

\section{An algorithm for MCE}

The basis of the algorithm for MCE that will be described in this section is the adaptation of the algorithm for MCE-1, so it returns a CLS for every ellipse in $\E$. Once a CLS is obtained for every facility, a simple complete search can be done to find an optimal solution.
The procedure that does that is described by procedure MCE-CLS in \autoref{algoritmo:mce1}.

\begin{lema}
	Given an instance of MCE, and $j\in\{1, \dots, m\}$, then \autoref{algoritmo:mce1}, with $(\Pp; \Ww; (a_j,b_j))$ as its input, takes $\bigO(n^2\log{n})$ computations and returns a CLS of size $\bigO(n^2)$ that contains an optimal solution of the given MCE's instance.
\end{lema}

\begin{proof}
	\autoref{algoritmo:mce1} is an adaption of \autoref{algoritmo:mcd_1}, which relies on the idea of transforming MCD into the MWC problem.
\end{proof}

\autoref{algoritmo:mce} describes the adapted version of the maximal disk covering algorithm for the ellipses case. In \autoref{algoritmo:mce1}, the $MCE_1$ procedure returns every possible set of points that an ellipse with shape parameters $(a,b)$ can cover. With that, procedure $MCE$ does the backtracking process, assigning every possible cover to every ellipse.

As stated in \autoref{lema:disk}, $MCE_1$ runs in $\bigO(n^2\log{n})$, where $n$ is the number of points. The number of sets of points an ellipse can cover, however, is $\bigO(n^2)$. Note that the $\log{n}$ being part of the complexity is due to sorting the set $A$. If $MCE_1$ is called only in a pre-process phase storing its return for every ellipse, a $\bigO(n^{2m})$ run-time complexity can be achieved. 

Also, it can be seen that the unitary weights assumption can be easily removed through replacing the way the answer is updated: 
the weights of the covered points should be added to the answer instead of the number of covered points, this could be done by keeping an extra variable along with every possible set of points an ellipse can cover that is returned by $MCE_1$.

It is worth noting that some easy improvements, which do not change the algorithm's overall complexity, can be made in the implementation. For example, if an ellipse covers two sets of points $X$ and $Y$, with $X \subset Y$, then set $X$ can be ignored by the algorithm because of the positive weights constraint. Also, if two ellipses have their centers with Euclidean distance greater than their semi-major parameter, they for sure do not intersect. Depending on the input, this observation can make the algorithm not go through the whole list of ellipses every time it needs to determine the ellipses pairwise intersections.



\begin{algoritmo}
\caption{Algorithm for $MCE(\Pp, a, b)$ with unit weights}\label{algoritmo:mce1}
%\KwIn{alskdjf}

\begin{algorithmic}[1]
\Require{A set of points $\Pp=\{p_1,\dots,p_n\}$, and the shape parameters $(a, b)$ of an ellipse.}
\Ensure{A collection of subsets of $\Pp$ that the ellipse is able to cover.}

\item[]
\Procedure{$MCE_1$}{$\Pp, a, b$}
\State $Z \gets \{\}$ \Comment{A collection of subsets of $\Pp$, each being a possible coverage.}

\ForAll{$p_i \in \Pp$}
\State Let $E_i$ be the ellipse with center at $p_i$ and parameters $(a,b)$

\State Let $I_i$ be the set of ellipses that intersect with $E_i$

%\State $A \gets \{\}$ \Comment{The multiset of intersection angles with $E_i$}

\State $A \gets \bigcup_{j \in I_i} \{\Gamma_+(i,j) \cup \Gamma_-(i,j)\}$ \Comment{The multiset of intersection angles with $E_i$.}

%\ForAll{$j \in I_i$}
%\State $A \gets A \cup \{\Gamma_+(i,j) \cup \Gamma_-(i,j)\}$
%\EndFor

\State $Z \gets Z \cup \{\{p_i\}\}$
\State $Cov \gets \{p_i\}$ \Comment{The set of active disks.}

\For{$cnt=1..2$} \Comment{Do it twice.}
\For{$a \in A$}\Comment{Assuming $A$ is sorted.}
\State Let $p_a$ be the point represented by the ellipse that intersects $E_i$ at angle $a$. 
\If{$a$ is a starting angle}
\State $Cov \gets Cov \cup \{p_a\}$
\Else
\State $Cov \gets Cov \setminus \{p_a\}$
\EndIf
\State $Z \gets Z \cup \{Cov\}$
\EndFor
\EndFor
\EndFor

\State \Return $Z$
\EndProcedure


\end{algorithmic}
\end{algoritmo}

\begin{algoritmo}
    \caption{Algorithm for $MCE(\Pp, \E)$ with unit weights}\label{algoritmo:mce}
    \begin{algorithmic}[1]
        \Require{A set of points $\Pp=\{p_1,\dots,p_n\}$, and a set of ellipses $\E = \{E_1, \dots, E_m\}$.}
        \Ensure{The maximum number of points that can be covered by the set of ellipses $\E$.}
        
        \item[]
        
        \Procedure{$MCE$}{$\Pp, \E, j=1$}
        \If{$j = m+1$}
        \State \Return $0$
        \EndIf
        
        \State $ans \gets 0$
        \For{$E \in \E$}
        \State Let $(a,b)$ be the shape parameters of $E$
        \State $Q \gets MCE_1(\Pp, a, b)$
        \For{$Cov \in Q$}
        \State $ans \gets \max\{ans, |Cov| + MCE(\Pp \setminus Cov, \E, j+1)\}$ \Comment{Calls the procedure for the next ellipse.}
        \EndFor
        \EndFor
        
        \State \Return $ans$
        \EndProcedure
    \end{algorithmic}
\end{algoritmo}